<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Decap CMS | Laxy Guide</title>
  <meta name="viewport" content="width=device-width" />
  <link rel="stylesheet" href="https://unpkg.com/decap-cms@^3.9.0/dist/decap-cms.css" />
</head>
<body>
<script src="https://unpkg.com/decap-cms@^3.9.0/dist/decap-cms.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const CMSGlobal = window.DecapCMS || window.CMS;
    if (!CMSGlobal) {
      console.error('Decap CMS global not found.');
      return;
    }
    CMSGlobal.init({
      config: {
        backend: {
          name: 'github',
          repo: 'LaxyVibe/LaxyGuideCMS', // change to real owner/repo
          branch: 'main'
        },
        media_folder: 'public/media',
        public_folder: '/media',
        publish_mode: 'editorial_workflow',
        collections: [
          {
            name: 'displayItems',
            label: 'Display Items',
            folder: 'content/displayItems',
            create: true,
            slug: '{{slug}}',
            preview_path: 'display/{{slug}}',
            sortable_fields: ['title', 'year'],
            fields: [
              { label: 'Title', name: 'title', widget: 'string' },
              { label: 'Short Title', name: 'shortTitle', widget: 'string', required: false },
              { label: 'Slug', name: 'slug', widget: 'string', pattern: ['^[a-z0-9-]+$', 'Use lowercase, numbers, hyphens'] },
              { label: 'Category', name: 'category', widget: 'select', options: ['painting', 'sculpture', 'artifact', 'document', 'interactive', 'other'] },
              { label: 'Year', name: 'year', widget: 'number', value_type: 'int', required: false, hint: 'Approximate year' },
              { label: 'Location Code', name: 'location', widget: 'string' },
              { label: 'Coordinates', name: 'coordinates', widget: 'object', fields: [
                { label: 'Latitude', name: 'lat', widget: 'number', required: false },
                { label: 'Longitude', name: 'lng', widget: 'number', required: false }
              ] },
              { label: 'Tags', name: 'tags', widget: 'list', summary: '{{fields.item}}', required: false },
              { label: 'Images', name: 'images', widget: 'list', required: false, field: { label: 'Image', name: 'image', widget: 'image' } },
              { label: 'Audio Guide', name: 'audio', widget: 'file', required: false },
              { label: 'Description', name: 'body', widget: 'markdown' }
            ]
          }
        ]
      }
    });

    const el = React.createElement;
    const DisplayItemPreview = ({ entry, widgetFor }) => el('div', {}, [
      el('h2', {}, entry.getIn(['data', 'title'])),
      el('p', {}, 'Category: ' + entry.getIn(['data', 'category'])),
      el('div', {}, widgetFor('body'))
    ]);
    CMSGlobal.registerPreviewTemplate('displayItems', DisplayItemPreview);
    console.log('Decap CMS initialized (GitHub backend)');
  });
</script>
</body>
</html>
